machine:
  ruby:
    version: 2.3.0

  timezone:
    Asia/Tokyo


dependencies:
  pre:
    - rvm install 2.3.0

  cache_directories:
    - vendor/bundle

  override:
    - bundle install --path vendor/bundle --without development


test:
  override:
    - bundle exec rspec


deployment:
  production:
    branch: master
    commands:
      - fab deploy -f fabfile.py -H $PRODUCTION_HOST -u $SSH_USER_NAME --port=$SSH_PORT > $CIRCLE_ARTIFACTS/deploy.log

  staging:
    branch: develop
    commands:
      - fab deploy -f fabfile.py -H $PRODUCTION_HOST -u $SSH_USER_NAME --port=$SSH_PORT > $CIRCLE_ARTIFACTS/deploy.log
